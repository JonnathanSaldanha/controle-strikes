<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Strikes - Fornecedores</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    
    <style>
        /* [Mantenha todo seu CSS original aqui] */
        :root {
            --primary: #4285f4;
            --primary-dark: #3367d6;
            /* ... todos os seus estilos ... */
        }
        /* ... */
    </style>
</head>
<body>
    <!-- [Mantenha todo seu HTML original aqui] -->
    <div id="loginScreen" class="login-container">
        <!-- ... -->
    </div>

    <div id="appContainer" class="container" style="display: none;">
        <!-- ... todo o conteúdo da sua interface ... -->
    </div>

    <script>
        // ================== CONFIGURAÇÃO FIREBASE ================== //
        const firebaseConfig = {
            apiKey: "AIzaSyA1yYOHNQlYeLVW8-dJytZWi5nxrOw5sKg",
            authDomain: "controle-de-strikes.firebaseapp.com",
            databaseURL: "https://controle-de-strikes-default-rtdb.firebaseio.com",
            projectId: "controle-de-strikes",
            storageBucket: "controle-de-strikes.firebasestorage.app",
            messagingSenderId: "1020219235699",
            appId: "1:1020219235699:web:a905c972b399020c6a7906",
            measurementId: "G-L96DH4PCDZ"
        };

        // Inicialize o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const fornecedoresRef = database.ref('fornecedores');

        // ================== VARIÁVEIS GLOBAIS ================== //
        let editandoId = null;
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';

        // ================== FUNÇÕES FIREBASE ================== //
        function salvarFornecedor(fornecedor) {
            if (editandoId) {
                return fornecedoresRef.child(editandoId).update(fornecedor)
                    .then(() => {
                        showToast('Fornecedor atualizado com sucesso!');
                        cancelarEdicao();
                    });
            } else {
                return fornecedoresRef.push().set(fornecedor)
                    .then(() => showToast('Fornecedor cadastrado com sucesso!'));
            }
        }

        function carregarFornecedores(callback) {
            fornecedoresRef.on('value', (snapshot) => {
                const dados = snapshot.val() || {};
                const lista = Object.keys(dados).map(id => ({ id, ...dados[id] }));
                callback(lista);
            });
        }

        function excluirFornecedor(id) {
            return fornecedoresRef.child(id).remove()
                .then(() => showToast('Fornecedor excluído com sucesso!'));
        }

        // ================== FUNÇÕES DA INTERFACE ================== //
        function renderizarTabela(fornecedores) {
            const tabela = document.getElementById('corpoTabela');
            tabela.innerHTML = fornecedores.map(fornecedor => `
                <tr class="${fornecedor.strikes >= 3 ? 'strike-max' : fornecedor.strikes > 0 ? 'strike-warning' : ''}">
                    <td data-label="Fornecedor">${fornecedor.nome}</td>
                    <td data-label="CNPJ">${fornecedor.cnpjFormatado || formatarCNPJ(fornecedor.cnpj)}</td>
                    <td data-label="Local">${fornecedor.local}</td>
                    <td data-label="Empresa">${fornecedor.empresa}</td>
                    <td data-label="Strikes">${fornecedor.strikes || 0}/3</td>
                    <td data-label="Último Strike">${fornecedor.ultimoStrike || 'Nenhum'}</td>
                    <td data-label="Status">
                        <span class="status-badge ${
                            fornecedor.strikes >= 3 ? 'danger' : 
                            fornecedor.strikes > 0 ? 'warning' : 'success'
                        }">
                            ${fornecedor.strikes >= 3 ? 'Bloqueado' : 
                             fornecedor.strikes > 0 ? 'Atenção' : 'OK'}
                        </span>
                    </td>
                    <td data-label="Ações" class="acoes">
                        <button class="btn-editar" data-id="${fornecedor.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn-excluir" data-id="${fornecedor.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="btn-detalhes" data-id="${fornecedor.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            // Adiciona eventos aos botões
            document.querySelectorAll('.btn-editar').forEach(btn => {
                btn.addEventListener('click', () => editarFornecedor(btn.dataset.id));
            });
            
            document.querySelectorAll('.btn-excluir').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (confirm('Tem certeza que deseja excluir este fornecedor?')) {
                        excluirFornecedor(btn.dataset.id);
                    }
                });
            });
        }

        // [Mantenha todas as outras funções auxiliares: formatarCNPJ, validarCNPJ, showToast, etc.]

        // ================== INICIALIZAÇÃO ================== //
        document.addEventListener('DOMContentLoaded', function() {
            // Configura eventos
            document.getElementById('formFornecedor').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const [ano, mes] = document.getElementById('mesAno').value.split('-');
                const fornecedor = {
                    nome: document.getElementById('fornecedor').value.trim(),
                    cnpj: document.getElementById('cnpj').value.replace(/\D/g, ''),
                    empresa: document.getElementById('empresa').value,
                    local: document.getElementById('local').value.trim(),
                    mesAno: `${mes}-${ano}`,
                    observacao: document.getElementById('observacao').value.trim(),
                    data: new Date().toISOString(),
                    strikes: 1 // Você pode ajustar a lógica de strikes conforme necessário
                };

                salvarFornecedor(fornecedor).then(() => this.reset());
            });

            // Carrega dados iniciais
            carregarFornecedores(fornecedores => {
                renderizarTabela(fornecedores);
                atualizarDashboard(fornecedores);
            });

            // [Mantenha o resto da sua inicialização]
        });
    </script>
</body>
</html>
